

## 题目描述

在 $$ 个元素的全排列中，建立排列与它按字典序的排名之间的一一对应关系。需要支持两种操作：

1. **Q 操作**：给定一个排列，求出它的排名（从 1 开始）。
2. **P 操作**：给定一个排名，求出对应的排列。

这个问题是**康托展开 (Cantor Expansion)** 及其**逆运算**的典型应用。

## 解题思路

### 康托展开：排列求排名 (Q 操作)

康托展开的公式为： $$ 其中，$$ 表示在当前位右边（未出现的数字中）比第 $$ 位数字小的数字的个数。最终排名为 $$。

**举例说明**：求排列 `{1, 2, 5, 3, 4}` 在 $$ 的全排列中的排名。

1. **第一位是 1**：比 1 小的数有 0 个。贡献为 $$。
2. **第二位是 2**：在剩下的 `{2, 3, 4, 5}` 中，比 2 小的数有 0 个。贡献为 $$。
3. **第三位是 5**：在剩下的 `{3, 4, 5}` 中，比 5 小的数有 2 个 (3, 4)。贡献为 $$。
4. **第四位是 3**：在剩下的 `{3, 4}` 中，比 3 小的数有 0 个。贡献为 $$。
5. **第五位是 4**：在剩下的 `{4}` 中，比 4 小的数有 0 个。贡献为 $$。

总和 $$。排名为 $$。

为了高效地计算“未出现的数字中比当前数字小的个数”，我们可以使用**树状数组 (Fenwick Tree)**。初始时，树状数组记录所有数字都存在。每使用一个数字，就将其在树状数组中标记为不存在（值减 1）。查询时，我们只需要查询树状数组的前缀和即可。

### 逆康托展开：排名求排列 (P 操作)

这是康托展开的逆过程。给定排名 $$，我们从高位到低位依次确定排列的每一位。 首先，将排名 $$ 减 1，得到康托展开值 $$。

1. 用 $$ 除以 $$，商 $$，余数 $$。$$ 表示在当前所有可用数字中，有多少个比我们要找的数字小。所以，我们应该选择**第 $$ 小的可用数字**作为排列的第一位。
2. 用 $$ 除以 $$，商 $$，余数 $$。在剩下的可用数字中，选择第 $$ 小的数作为第二位。
3. ... 以此类推，直到确定所有位。

同样，为了高效查找“第 k 小的可用数字”，我们可以使用树状数组。在初始满的树状数组上进行二分查找或倍增，找到前缀和恰好为 $$ 的位置。